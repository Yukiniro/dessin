!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).zCanvas={})}(this,function(e){"use strict";function t(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function r(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?t(Object(r),!0).forEach(function(e){var t,i;t=n,e=r[i=e],i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(i);return u(this,n?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function l(e,t,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(i="Object"===i&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?d(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var _,y,v,g="ARGUMENT_ERROR",p="TEXT",E="LEFT_TOP",k="CENTER_TOP",x="RIGHT_TOP",w="RIGHT_CENTER",T="RIGHT_BOTTOM",O="CENTER_BOTTOM",m="LEFT_BOTTOM",b="LEFT_CENTER",S="CENTER",R=(_=Object.prototype.hasOwnProperty,{isUndefined:function(e){return void 0===e},isObject:function(e){return"object"===i(e)&&null!==e},deepClone:function(e){var t=this;if(this.isObject(e)){if(Array.isArray(e))return e.map(function(e){return t.deepClone(e)});var i,n={};for(i in e)_.call(e,i)&&(n[i]=this.deepClone(e[i]));return n}return e},mixin:function(e,t){return Object.assign(e,this.deepClone(t))},removeFromArray:function(e,t){if(!Array.isArray(e))throw g;t=e.indexof(t);-1!==t&&e.splice(t,1)},addEventListener:function(e,t,i){if(!e)throw new Error(g);e.addEventListener?e.addEventListener(t,i):e.attachEvent&&e.attachEvent("on".concat(t),i)},removeEventListener:function(e,t,i){if(!e)throw new Error(g);e.removeEventListener?e.removeEventListener(t,i):e.detachEvent&&e.detachEvent(t,i)},css:function(e,t){for(var i in t)_.call(t,i)&&(e.style[i]=t[i])},calcTextSize:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=i.fontSize,r=i.fontFamily,o=i.fontStyle,i=i.fontWeight;e.save(),e.font="".concat(o," ").concat(i," ").concat(n,"px ").concat(r);n=e.measureText(t),r=n.width,t=n.fontBoundingBoxAscent,n=n.fontBoundingBoxDescent;return e.restore(),{width:r,height:t+n,fontBoundingBoxAscent:t}},renderLine:function(e,t,i,n,r){var o=t.x,s=t.y,t=i.x,i=i.y,r=r&&r.dash||[];e.save(),e.fillStyle=n,e.beginPath(),e.setLineDash(r),e.moveTo(o,s),e.lineTo(t,i),e.stroke(),e.restore()},calePointInRect:function(e,t){var i=t.x,n=t.y,r=t.width,o=t.height,s={x:0,y:0};switch(e){case E:s={x:i,y:n};break;case k:s={x:i+r/2,y:n};break;case x:s={x:i+r,y:n};break;case w:s={x:i+r,y:n+o/2};break;case T:s={x:i+r,y:n+o};break;case O:s={x:i+r/2,y:n+o};break;case m:s={x:i,y:n+o};break;case b:s={x:i,y:n+o/2};break;case S:s={x:i+r/2,y:n+o/2}}return s},emptyFunc:function(){},isPointInRect:function(e,t){var i=e.x,n=e.y,r=t.x,o=t.y,e=t.width,t=t.height;return r<=i&&i<=r+e&&o<=n&&n<=o+t},calcCursorPoint:function(e){return{x:e.clientX,y:e.clientY}},calcDistance:function(e,t){var i=e.x,n=e.y,e=t.x,t=t.y,i=Math.abs(e-i),n=Math.abs(t-n);return Math.sqrt(Math.pow(i,2)+Math.pow(n,2))},calcVertor:function(e,t){var i=e.x,e=e.y;return{x:t.x-i,y:t.y-e}}}),C=(y=[],{add:function(e){y.includes(e)||y.push(e)},remove:function(e){R.removeFromArray(y,e)},forEachItem:function(i){var n=this;y.forEach(function(e,t){i.call(n,e,t)})},size:function(){return y.length},removeAll:function(){y.length=0},inserAt:function(e,t){y.splice(t,0,e)},includes:function(e){return y.includes(e)},all:function(){return y}}),F=(v={},{on:function(e,t){v[e]=v[e]||[],v[e].push(t)},off:function(e,t){v[e]&&R.removeFromArray(v[e],t)},resetListener:function(){v={}},fire:function(){var t=this,i=Array.prototype.slice.call(arguments),e=i.shift();(v[e]||[]).forEach(function(e){e.call.apply(e,[t].concat(f(i)))})}}),P={CREATED:"created",WILL_TRANSFORM:"willtransform",DID_TRANSFORM:"didtransfrom",WILL_RENDER:"willrender",DID_RENDER:"didrender",WILL_DESTROY:"willdestroy",DID_DESTROY:"diddestroy",SELECTED:"selected",DESELECTED:"deselected",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_HOVER:"mousehover",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",DBLCLICK:"dblclick",DRAG:"drag",DRAG_START:"dragstart",DRAG_END:"dragend",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DROP:"drop"},V={LEFT_TOP:0,CENTER_TOP:1,RIGHT_TOP:2,RIGHT_CENTER:3,RIGHT_BOTTOM:4,CENTER_BOTTOM:5,LEFT_BOTTOM:6,LEFT_CETNER:7,SELF:8,ROTATE:9,NONE:-1},L=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this._supportNodes=this.extendsValue(e.supportNodes,[0,1,2,3,4,5,6,7,8,9,-1]),this._lineColor=this.extendsValue(e.lineColor,"#08b9ff"),this._nodeColor=this.extendsValue(e.nodeColor,"#adadad"),this._nodeRadius=this.extendsValue(e.nodeRadius,4),this._rotateNodeOffset=10,this._cacheView=document.createElement("canvas"),this._cacheCtx=this._cacheView.getContext("2d"),this._owner=e.owner}return s(t,[{key:"owner",get:function(){return this._owner}},{key:"pos",get:function(){return this._owner.getPos()}},{key:"size",get:function(){return this._owner.getSize()}},{key:"angle",get:function(){return this._owner.getAngle()}},{key:"rect",get:function(){return r(r({},this.pos),this.size)}},{key:"extendsValue",value:function(e,t){return R.isUndefined(e)?t:e}},{key:"render",value:function(e){this._renderNodes(e),this._renderLines(e)}},{key:"clacTrackNodeWithPoint",value:function(t){var i=this,e=this._supportNodes.findIndex(function(e){e=i._calcNodePos(e),e={x:e.x-i._nodeRadius,y:e.y-i._nodeRadius,width:2*i._nodeRadius,height:2*i._nodeRadius};return R.isPointInRect(t,e)});return-1===e?R.isPointInRect(t,this.rect)?V.SELF:V.NONE:this._supportNodes[e]}},{key:"_calcNodePos",value:function(e){var t=this.rect,i={x:0,y:0};switch(e){case 0:i=R.calePointInRect(E,t);break;case 1:i=R.calePointInRect(k,t);break;case 2:i=R.calePointInRect(x,t);break;case 3:i=R.calePointInRect(w,t);break;case 4:i=R.calePointInRect(T,t);break;case 5:i=R.calePointInRect(O,t);break;case 6:i=R.calePointInRect(m,t);break;case 7:i=R.calePointInRect(b,t);break;case 9:i={x:width/2,y:this._nodeRadius-this._rotateNodeOffset};break;default:throw new Error(g)}return i}},{key:"_renderNodes",value:function(t){var i=this;this._supportNodes.forEach(function(e){e=i._calcNodePos(e);i._renderNode(t,e)})}},{key:"_renderNode",value:function(e,t){e.save(),e.fillStyle=this._nodeColor,e.beginPath(),e.arc(t.x,t.y,this._nodeRadius,0,2*Math.PI),e.fill(),e.restore()}},{key:"_renderLines",value:function(e){var t=this._calcNodePos(V.LEFT_TOP),i=this._calcNodePos(V.RIGHT_TOP),n=this._calcNodePos(V.LEFT_BOTTOM),r=this._calcNodePos(V.RIGHT_BOTTOM);this._renderLine(e,t,i),this._renderLine(e,i,r),this._renderLine(e,r,n),this._renderLine(e,n,t)}},{key:"_renderLine",value:function(e,t,i){e.save(),e.lineColor=this._lineColor,e.beginPath(),e.moveTo(t),e.lineTo(i),e.closePath(),e.restore()}}],[{key:"TRACK_NODES",value:function(){return V}}]),t}(),N=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this._lowerCanvas=e&&e.canvas,this._upperCanvas=document.createElement("canvas"),this._size={width:500,height:500},this._viewResponse=1,this._body=document.body,this._willOperateSprite=null,this._hasMousedown=!1,this._recordSprite=null,this._recordPoint=null,this._recordTrackNode=L.TRACK_NODES().NONE,this._recordSpriteData=null,this._initView(),this._updateView()}return s(t,[{key:"_initView",value:function(){if(!this._lowerCanvas)throw new Error("You have to bind a canvas!");var e=this._lowerCanvas.parentNode,t=e.style.position;e.insertBefore(this._upperCanvas,this._lowerCanvas.nextSibling),t&&"static"!==t||R.css(e,{position:"relative"}),R.css(this._lowerCanvas,{position:"absolute"}),R.css(this._upperCanvas,{position:"absolute"})}},{key:"_bindEvent",value:function(){this._lowerCanvas.addEventListener("mousedown",this._fireEvent),this._lowerCanvas.addEventListener("clcik",this._fireEvent),this._lowerCanvas.addEventListener("dblclick",this._fireEvent),this._lowerCanvas.addEventListener("mousemove",this._fireEvent)}},{key:"_unbindEvent",value:function(){this._lowerCanvas.removeEventListener("mousedown",this._fireEvent),this._lowerCanvas.removeEventListener("clcik",this._fireEvent),this._lowerCanvas.removeEventListener("dblclick",this._fireEvent),this._lowerCanvas.removeEventListener("mouseover",this._fireEvent)}},{key:"_bindEventForBody",value:function(){this._body.addEventListener("mousemove",this._fireEvent),this._body.addEventListener("mouseup",this._fireEvent)}},{key:"_unbindEventForBody",value:function(){this._body.removeEventListener("mousemove",this._fireEvent),this._body.removeEventListener("mouseup",this._fireEvent)}},{key:"_fireEvent",value:function(e){switch(e.type){case"mousedown":this._recordPoint=R.calcCursorPoint(e),this._bindEventForBody(),this._recordSprite=this._getTopSprite(this._recordPoint),this._hasMousedown=!0,this._recordSprite&&(this._recordTrackNode=this._recordSprite.calcTrackNode(this._recordPoint),this._recordSpriteData=this._recordSpriteData.encode(),this.selectSprite(this._recordSprite)),this.renderTrack();break;case"click":case"dblclick":break;case"mousemove":var t;this._recordSprite&&(t=R.calcCursorPoint(e),t=R.calcVertor(this._recordPoint,t),this._recordSprite.transform(this._recordTrackNode,t,this._recordSpriteData));break;case"mouseup":this._unbindEventForBody(),this._hasMousedown=!1,this._recordSprite=null,this._recordPoint=null,this._hasMousedown=!1}}},{key:"selectSprite",value:function(t){return t?(this.forEachItem(function(e){e.id===t?e.isSelect()||e.select():e.isSelect()&&e.deselect()}),this):this.deselectAll()}},{key:"deselectAll",value:function(){return this.forEachItem(function(e){e.isSelect()&&e.deselect()}),this}},{key:"_getTopSprite",value:function(e){for(var t=null,i=this.all(),n=0;n<this.size();n++){var r=i[n];if(r&&r.isPointInSelf(e)){t=r;break}}return t}},{key:"_updateView",value:function(){var e=this._size,t=e.width,e=e.height;this._lowerCanvas.width=t,this._lowerCanvas.height=e,this._upperCanvas.width=t,this._upperCanvas.height=e,this.render()}},{key:"_clear",value:function(){var e=this.getSize(),t=e.width,e=e.height;this._lowerCanvas.getContext("2d").clearRect(0,0,t,e)}},{key:"render",value:function(){var t=this;this.forEachItem(function(e){e.render(t._lowerCanvas.getContext("2d")),e.renderTrack(t._upperCanvas.getContext("2d"))})}},{key:"getSize",value:function(){return this._size}},{key:"setSize",value:function(e){return this._size=r({},e),this._updateView(),this}},{key:"renderTrack",value:function(){}}]),t}();R.mixin(N.prototype,C),R.mixin(N.prototype,F);var A,D=1,I=new Uint8Array(16);var z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var B=[],Y=0;Y<256;++Y)B.push((Y+256).toString(16).substr(1));function M(e,t){t=1<arguments.length&&void 0!==t?t:0,e=(B[e[t+0]]+B[e[t+1]]+B[e[t+2]]+B[e[t+3]]+"-"+B[e[t+4]]+B[e[t+5]]+"-"+B[e[t+6]]+B[e[t+7]]+"-"+B[e[t+8]]+B[e[t+9]]+"-"+B[e[t+10]]+B[e[t+11]]+B[e[t+12]]+B[e[t+13]]+B[e[t+14]]+B[e[t+15]]).toLowerCase();if("string"!=typeof(t=e)||!z.test(t))throw TypeError("Stringified UUID is invalid");return e}function j(e,t,i){var n=(e=e||{}).random||(e.rng||function(){if(!A&&!(A="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(I)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return M(n)}var X=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this._id=j(),this._type=this.extendsValue(e.type,""),this._x=this.extendsValue(e.x,0),this._y=this.extendsValue(e.y,0),this._width=this.extendsValue(e.width,0),this._height=this.extendsValue(e.height,0),this._angle=this.extendsValue(e.angle,0),this._originX=this.extendsValue(e.originX,0),this._originY=this.extendsValue(e.originY,0),this._flipX=this.extendsValue(e.flipX,1),this._flipY=this.extendsValue(e.flipY,0),this._opacity=this.extendsValue(e.opacity,1),this._value=this.extendsValue(e.value,""),this._supportNodes=[0,1,2,3,4,5,6,7,8,9,-1],this._evented=this.extendsValue(e._evented,!0),this._selected=!1,this._cacheView=document.createElement("canvas"),this._cacheCtx=this._cacheView.getContext("2d"),this._track=null}return s(t,[{key:"encode",value:function(){return{id:this.id(),type:this.type,x:this.getX(),y:this.getY(),width:this.getWidth(),hieght:this.getHeight(),angle:this.getAngle(),originX:this.getOriginX(),originY:this.getOriginY(),flipX:this.getFlipX(),flipY:this.getFlipY(),opacity:this.getOpacity(),value:this.getValue()}}},{key:"decode",value:function(e){this._id=this.extendsValue(e.id,j()),this._type=this.extendsValue(e.type,this.getType()),this._x=this.extendsValue(e.x,this.getX()),this._y=this.extendsValue(e.y,this.getY()),this._width=this.extendsValue(e.width,this.getWidth()),this._height=this.extendsValue(e.height,this.getHeight()),this._angle=this.extendsValue(e.angle,this.getAngle()),this._originX=this.extendsValue(e.originX,this.getOriginX()),this._originY=this.extendsValue(e.originY,this.getOriginY()),this._flipX=this.extendsValue(e.flipX,this.getFlipY()),this._flipY=this.extendsValue(e.flipY,this.getFlipY()),this._opacity=this.extendsValue(e.opacity,this.getOpacity()),this._value=this.extendsValue(e.value,this.getValue())}},{key:"extendsValue",value:function(e,t){return R.isUndefined(e)?t:e}},{key:"type",get:function(){return this._type}},{key:"rect",get:function(){return r(r({},this.getPos()),this.getSize())}},{key:"id",get:function(){return this._id}},{key:"setEventSupport",value:function(e){this._evented=e}},{key:"getEventSuppor",value:function(){return this._evented}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){return this._value=e,this}},{key:"getWidth",value:function(){return this._width}},{key:"setWidth",value:function(e){return this._width=e,this}},{key:"getHeight",value:function(){return this._height}},{key:"setHeight",value:function(e){return this._height=e,this}},{key:"getSize",value:function(){return{width:this._width,height:this._height}}},{key:"setSize",value:function(e){var t=R.isUndefined;if(!(0,R.isObject)(e))throw new Error(g);return t(e.width)||(this._width=e.width),t(e.height)||(this._height=e.height),this}},{key:"getX",value:function(){return this._x}},{key:"setX",value:function(e){return this._x=e,this}},{key:"getY",value:function(){return this._y}},{key:"setY",value:function(e){return this._y=e,this}},{key:"getPos",value:function(){return{x:this._x,y:this._y}}},{key:"setPos",value:function(e){var t=R.isObject,i=R.isUndefined;if(!t(e))throw new Error(g);return i(e.x)||(this._x=e.x),i(e.y)||(this._y=e.y),this}},{key:"getOpacity",value:function(){return this._opacity}},{key:"setOpacity",value:function(e){return this._opacity=e,this}},{key:"getOriginX",value:function(){return this._originX}},{key:"setOriginX",value:function(e){return this._originX=e,this}},{key:"getOriginY",value:function(){return this._originY}},{key:"setOriginY",value:function(e){return this._originY=e,this}},{key:"getOrigin",value:function(){return{x:this._originX,y:this._originY}}},{key:"setOrigin",value:function(e){var t=R.isObject,i=R.isUndefined;if(!t(e))throw new Error(g);return i(e.x)||(this._originX=e.x),i(e.y)||(this._originY=e.y),this}},{key:"getAngle",value:function(){return this._angle}},{key:"setAngle",value:function(e){return this._angle=e,this}},{key:"getFlipX",value:function(){return this._flipX}},{key:"setFlipX",value:function(e){return this._flipX=e,this}},{key:"getFlipY",value:function(){return this._flipY}},{key:"setFlipY",value:function(e){return this._flipY=e,this}},{key:"isSelected",value:function(){return this._selected}},{key:"select",value:function(){return this._selected=!0,this.fire(P.SELECTED,{target:this}),this}},{key:"deselect",value:function(){return this._selected=!1,this.fire(P.DESELECTED,{target:this}),this}},{key:"renderCache",value:function(){}},{key:"render",value:function(){this.fire(P.WILL_RENDER,{target:this}),this.fire(P.DID_RENDER,{target:this})}},{key:"renderTrack",value:function(e){this._track=this._track||new L({supportNodes:this._supportNodes,owner:this}),this._track.render(e)}},{key:"transform",value:function(e,t,i){var n=L.TRACK_NODES(),r=n.SELF;n.LEFT_TOP,n.CENTER_TOP,n.RIGHT_TOP,n.RIGHT_CENTER,n.RIGHT_BOTTOM,n.CENTER_BOTTOM,n.LEFT_BOTTOM,n.LEFT_CETNER;var o=t.x,s=t.y,n=i.x,t=i.y;i.width,i.height,this.fire(P.WILL_TRANSFORM,{target:this}),e===r&&(this.setX(n+o),this.setY(t+s)),this.fire(P.DID_TRANSFORM,{target:this})}},{key:"destroy",value:function(){this.fire(P.WILL_DESTROY,{target:this}),this.resetListener(),this.fire(P.DID_DESTROY)}},{key:"isPointInSelf",value:function(e){return R.isPointInRect(e,this.rect)}},{key:"calcTrackNode",value:function(e){return this._track.clacTrackNodeWithPoint(e)}}]),t}();R.mixin(X.prototype,F);C=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,X);var i=c(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return o(this,n),(e=i.call(this,t))._type=p,e._fontSize=e.extendsValue(t.fontSize,36),e._fontStyle=e.extendsValue(t.fontStyle,"normal"),e._fontWeight=e.extendsValue(t.fontWeight,"normal"),e._fontFamily=e.extendsValue(t.fontFamily,"sans-serif"),e._textAlign=e.extendsValue(t.textAlign,"center"),e._lineHeight=e.extendsValue(t.lineHeight,1.2),e._fillColor=e.extendsValue(t.fillColor,"#FFFFFF"),e._strokeColor=e.extendsValue(t.strokeColor,"#FFFFFF"),e._value=e.extendsValue(t.value,["Enter Your Text"]),e._supportNodes=[0,2,4,6],e._fontBoundingBoxAscent=0,e.initSize(),e.renderCache(),e}return s(n,[{key:"encode",value:function(){return r(r({},l(a(n.prototype),"encode",this).call(this)),{},{fontSize:this.getFontSize(),fontStyle:this.getFontStyle(),fontWeight:this.getFontWeight(),fontFamily:this.getFontFamily(),textAlign:this.getTextAlign(),lienHeight:this.getLineHeight()})}},{key:"decode",value:function(e){l(a(n.prototype),"decode",this).call(this,e),this._fontSize=this.extendsValue(e.fontSize,this.getFontSize()),this._fontStyle=this.extendsValue(e.fontStyle,this.getFontStyle()),this._fontWeight=this.extendsValue(e.fontWeight,this.getFontWeight()),this._textAlign=this.extendsValue(e.textAlign,this.getTextAlign()),this._lineHeight=this.extendsValue(e.lineHeight,this.getLineHeight()),this.initSize(),this.renderCache()}},{key:"_calcSize",value:function(){var r=this;return this._value.reduce(function(e,t){var i={fontSize:r._fontSize,fontFamily:r._fontFamily,fontStyle:r._fontStyle,fontWeight:r._fontWeight},n=R.calcTextSize(r._cacheCtx,t,i),t=n.width,i=n.height,n=n.fontBoundingBoxAscent;return{width:Math.max(t,e.width),height:i+e.height,fontBoundingBoxAscent:n}},{width:0,height:0,fontBoundingBoxAscent:0})}},{key:"getFontSize",value:function(){return this._fontSize}},{key:"setFontSize",value:function(e){return this._fontSize=e,this}},{key:"getFontStyle",value:function(){return this._fontStyle}},{key:"setFontStyle",value:function(e){return this._fontStyle=e,this}},{key:"getFontWeight",value:function(){return this._fontWeight}},{key:"setFontWeight",value:function(e){return this._fontWeight=e,this}},{key:"getFontFamily",value:function(){return this._fontFamily}},{key:"setFontFamily",value:function(e){return this._fontFamily=e,this}},{key:"getTextAlign",value:function(){return this._textAlign}},{key:"setTextAlign",value:function(e){return this._textAlign=e,this}},{key:"getLineHeight",value:function(){return this._lineHeight}},{key:"setLineHeight",value:function(e){return this._lineHeight=e,this}},{key:"getFillColor",value:function(){return this._fillColor}},{key:"setFillColor",value:function(e){return this._fillColor=e,this}},{key:"getStrokeColor",value:function(){return this._strokeColor}},{key:"setStrokeColor",value:function(e){return this._strokeColor=e,this}},{key:"initSize",value:function(){var e=this._calcSize(),t=e.width,i=e.height,e=e.fontBoundingBoxAscent;this.setSize({width:t,height:i}),this._fontBoundingBoxAscent=e}},{key:"renderCache",value:function(){var i,n=this,e=D,r=0,t=this._width*e,o=this._height*e,s=this._fontSize*e;switch(this._textAlign){case"left":break;case"center":r=t/2;break;case"right":r=t}this._cacheView.width=t,this._cacheView.height=o,this._cacheCtx.font="".concat(this._fontStyle," ").concat(this._fontWeight," ").concat(s,"px ").concat(this._fontFamily),this._cacheCtx.fillStyle=this._fillColor,this._cacheCtx.strokeStyle=this._strokeColor,this._cacheCtx.textAlign=this._textAlign,this._value.forEach(function(e,t){i=t*n._lineHeight*s+n._fontBoundingBoxAscent,n._cacheCtx.fillText(e,r,i)})}},{key:"render",value:function(e){var t=P.DID_RENDER;this.fire(P.WILL_RENDER,{target:this}),e.drawImage(this._cacheView,this._x,this._y,this._width,this._height),this.fire(t,{target:this})}}]),n}(),F=P;e.ZCanvas=N,e.ZText=C,e.zEvent=F,Object.defineProperty(e,"__esModule",{value:!0})});
